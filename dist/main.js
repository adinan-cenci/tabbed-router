(()=>{"use strict";const t=class{constructor(t,e){this.patterns=Array.isArray(t)?t:[t],this.callback=e}callIt(t){var e=this.getMatchingPattern(t.path),s=this.getAttributesFromPath(t.path,e);return t.setAttributes(s),this.instantiateElement(t)}instantiateElement(t){var e;return"string"==typeof this.callback?e=document.createElement(this.callback):"function"==typeof this.callback&&(e=this.callback.apply(this,[t])),e.request=t,e}doesItMatcheRequest(t){return!!this.getMatchingPattern(t.path)}getMatchingPattern(t){for(var e of this.patterns)if(t.match(e))return e;return null}getAttributesFromPath(t,e){return e.exec(t).groups||{}}},e=class{constructor(){this.routes=[]}call(t,e){return t.callIt(e)}getMatchingRoute(t){for(var e of this.routes)if(e.doesItMatcheRequest(t))return e;return null}addRoute(t){return this.routes.push(t),this}createRoute(e,s){return this.addRoute(new t(e,s))}};class s{constructor(t,e,s={},a={}){this.path=t,this.queryParams="string"==typeof e?new URLSearchParams(e):e,this.attributes=s,this.meta=a}setAttributes(t){this.attributes=t}getAttribute(t,e=null){return this.attributes[t]||e}static createFromAnchor(t){var e=t.getAttribute("href"),a=t.getAttribute("title")||null,r=s.createFromHref(e);return r.meta.title=a,r}static createFromHref(t){var e=new URL(t,"https://"+window.location.host);if(!e.hash)return null;var a=new URL(e.hash.replace("#","/"),"https://"+window.location.host);return e.host!=window.location.host?null:new s(a.pathname,a.searchParams)}}const a=s;class r extends HTMLElement{constructor(){super(),this.$refs={},this.label="",this.tabId="",this.rendered=!1}connectedCallback(){this.rendered||this.render()}render(){this.rendered=!0,this.classList.add("tab-link"),this.$refs.label=document.createElement("span"),this.$refs.label.innerHTML=this.label,this.append(this.$refs.label),this.$refs.closeBtn=document.createElement("button"),this.$refs.closeBtn.setAttribute("title","close tab"),this.append(this.$refs.closeBtn),this.addEventListener("click",this.onclick.bind(this)),this.$refs.closeBtn.addEventListener("click",this.onCloseBtnClick.bind(this))}onclick(){var t=new CustomEvent("tab-link:clicked",{});this.dispatchEvent(t)}onCloseBtnClick(t){t.stopPropagation(),t.preventDefault();var e={bubbles:!0,detail:this.tabId},s=new CustomEvent("tab-request:closing",e);this.dispatchEvent(s)}setLabel(t){this.label=t,this.rendered&&(this.$refs.label.innerHTML=t)}setTabId(t){this.tabId=t}}const i=r;class n extends HTMLElement{constructor(){super(),this.history=[],this.historyIndex=-1}setRouteCollection(t){this.routeCollection=t}connectedCallback(){this.classList.add("tab-panel"),this.addEventListener("click",this.linkClick.bind(this))}linkClick(t){if("A"==t.target.tagName&&!t.ctrlKey&&"_blank"!=t.target.getAttribute("target")){t.tabAvaliated=!0;var e=t.target,s=a.createFromAnchor(e);if(s){var r,i=s.path.replace("/","#");try{r=document.querySelector(i)}catch{r=!1}r||(t.stopPropagation(),t.preventDefault(),this.goTo(s))}}}request(t){var e=this.routeCollection.getMatchingRoute(t),s=e?e.callIt(t):this.notFoundCallback(t);this.stageElement(s);var a=new CustomEvent("tab:request",{bubbles:!0,detail:t});this.dispatchEvent(a)}backwards(){this.historyIndex<=0||(this.historyIndex--,this.request(this.history[this.historyIndex]))}forwards(){this.historyIndex!=this.history.length-1&&(this.historyIndex++,this.request(this.history[this.historyIndex]))}goTo(t){this.history=this.history.slice(0,this.historyIndex+1),this.history.push(t),this.request(t),this.historyIndex++}stageElement(t){this.clearStage(),this.addToStage(t)}clearStage(){this.querySelectorAll(":scope > *").forEach((t=>{t.remove()}))}addToStage(t){this.append(t)}notFoundCallback(t){var e=document.createElement("div");return e.innerHTML="Nothing found",t.meta.title=t.meta.title?t.meta.title+" ( not found )":"not found",e}}const o=n;class h extends HTMLElement{constructor(){super(),this.$refs={},this.links={},this.tabs={},this.tabCount=0,this.rendered=!1,this.currentTabId=null,this.routeCollection=null}setRouteCollection(t){this.routeCollection=t}connectedCallback(){this.rendered||this.render()}render(){for(var t in this.rendered=!0,this.classList.add("tab-manager"),this.$refs.header=document.createElement("div"),this.$refs.header.classList.add("tab-manager__header"),this.append(this.$refs.header),this.$refs.controls=document.createElement("div"),this.$refs.controls.classList.add("tab-manager__controls"),this.$refs.header.append(this.$refs.controls),this.$refs.backwardButton=document.createElement("button"),this.$refs.backwardButton.title="Backwards",this.$refs.backwardButton.classList.add("tab-manager__backwards-button"),this.$refs.controls.append(this.$refs.backwardButton),this.$refs.forwardButton=document.createElement("button"),this.$refs.forwardButton.title="Forwards",this.$refs.forwardButton.classList.add("tab-manager__forwards-button"),this.$refs.controls.append(this.$refs.forwardButton),this.$refs.backwardButton.addEventListener("click",this.backwards.bind(this)),this.$refs.forwardButton.addEventListener("click",this.forwards.bind(this)),this.$refs.tabLinks=document.createElement("div"),this.$refs.tabLinks.classList.add("tab-manager--tab-links"),this.$refs.header.append(this.$refs.tabLinks),this.$refs.tabPanes=document.createElement("div"),this.$refs.tabPanes.classList.add("tab-manager--tab-panes"),this.append(this.$refs.tabPanes),this.tabs)this.attachTab(t);document.addEventListener("click",this.onClick.bind(this)),this.addEventListener("tab:request",this.onTabRequest.bind(this)),this.addEventListener("tab-request:closing",this.onRequestToCloseTab.bind(this))}onRequestToCloseTab(t){if(!(this.tabCount<=1)){var e=t.detail;if(e==this.currentTabId){var s=(this.links[e].previousSibling||this.links[e].nextSibling).tabId;this.focusTab(s)}this.removeTab(e)}}onClick(t){if(!t.tabAvaliated&&"A"==t.target.tagName){var e=t.target,s=a.createFromAnchor(e),r=e.getAttribute("target")||"self";if(s){var i,n=s.path.replace("/","#");try{i=document.querySelector(n)}catch{i=!1}i||(t.stopPropagation(),t.preventDefault(),t.ctrlKey?this.openInNewTab(s,!1):"_blank"==r?this.openInNewTab(s,!0):this.tabs[this.currentTabId].goTo(s))}}}openInNewTab(t,e=!1){var s=this.generateNewTabId(),a=this.createTab(s,e);return a.goTo(t),a}generateNewTabId(){var t;do{t="tab-"+Math.floor(1e3*Math.random())}while(this.tabs[t]);return t}onTabRequest(t){var e=this.getTabIdForTabPanel(t.target),s=t.detail;console.log(this.links),this.links[e].setLabel(s.meta.title||e)}getTabIdForTabPanel(t){for(var e in this.tabs)if(this.tabs[e]==t)return e;return null}backwards(){this.tabs[this.currentTabId].backwards()}forwards(){this.tabs[this.currentTabId].forwards()}focusTab(t){for(var e in this.currentTabId=t,this.tabs)e==t?(this.tabs[e].classList.add("focused"),this.links[e].classList.add("focused")):(this.tabs[e].classList.remove("focused"),this.links[e].classList.remove("focused"))}createTab(t,e=!0){var s=new o;return this.setTab(t,s),e&&this.focusTab(t),s}setTab(t,e){if(this.tabs[t])throw"Tab {tabId} is already set";e.setRouteCollection(this.routeCollection);var s=this.createTabButton(t,t);this.tabs[t]=e,this.links[t]=s,this.rendered&&this.attachTab(t)}removeTab(t){var e;return this.tabs[t]?(e=this.tabs[t],this.rendered&&this.detachTab(t),e):null}attachTab(t){var e=this.tabs[t],s=this.links[t];this.$refs.tabLinks.append(s),this.$refs.tabPanes.append(e),this.tabCount++}detachTab(t){this.links[t].remove(),delete this.links[t],this.tabs[t].remove(),delete this.tabs[t],this.tabCount--}createTabButton(t,e){var s=new i;return s.setTabId(t),s.setLabel(e),s.addEventListener("tab-link:clicked",(t=>{this.focusTab(t.target.tabId)})),s}}const c=h;class l extends HTMLElement{connectedCallback(){var t=parseInt(this.request.queryParams.get("n")||1);this.append(this.createP("test: "+t)),this.append(this.createP("",[this.createA("<<","#test-first:123?n="+(t-1),"decrement"),"      ",this.createA(">>","#test-first:123?n="+(t+1),"increment")])),this.append(this.createP("",this.createA("open in new tab","#test-first:123?n=69","new tab","_blank"))),this.append(this.createP("",this.createA("broken link","#broken"))),this.append(this.createP("",this.createA("actual thing","#actualThing"))),this.append(this.createP("",this.createA("regular link","https://google.com")))}createP(t="",e=null){e=Array.isArray(e)?e:[e];var s=document.createElement("p");for(var a of(s.innerHTML=t,e))a&&s.append(a);return s}createA(t="",e,s="",a="_self"){var r=document.createElement("a");return r.innerHTML=t,r.setAttribute("title",s),r.setAttribute("href",e),r.setAttribute("target",a),r}}customElements.define("test-first",l),customElements.define("tab-manager",c),customElements.define("tab-panel",o),customElements.define("tab-link",i),document.addEventListener("DOMContentLoaded",(()=>{const t=new e;t.createRoute(/test-first:(?<foobar>.+)/,"test-first");const s=new c;s.setRouteCollection(t);const r=s.createTab("main-tab",!0);s.createTab("secondary-tab",!1),window.routeCollection=t,window.tabManager=s,document.body.append(s);const i=new a("test-first:123","");r.goTo(i);var n=document.createElement("div");n.setAttribute("id","actualThing"),document.body.append(n);var o=document.createElement("a");o.setAttribute("href","#test-first:123?n=1000"),o.setAttribute("title","from the outside"),o.innerHTML="outside",document.body.append(o)}))})();