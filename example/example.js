(()=>{"use strict";const t=class{constructor(t,e){this.patterns=Array.isArray(t)?t:[t],this.callback=e}callIt(t){var e=this.getMatchingPattern(t.path),s=this.getAttributesFromPath(t.path,e);return t.setAttributes(s),this.instantiateElement(t)}instantiateElement(t){var e;return"string"==typeof this.callback?e=document.createElement(this.callback):"function"==typeof this.callback&&(e=this.callback.apply(this,[t])),e.request=t,e}doesItMatchTheRequest(t){return!(!t.path||!this.getMatchingPattern(t.path))}getMatchingPattern(t){for(var e of this.patterns)if(t.match(e))return e;return null}getAttributesFromPath(t,e){return e.exec(t).groups||{}}},e=class{constructor(){this.routes=[]}call(t,e){return t.callIt(e)}getMatchingRoute(t){for(var e of this.routes)if(e.doesItMatchTheRequest(t))return e;return null}addRoute(t){return this.routes.push(t),this}createRoute(e,s){return this.addRoute(new t(e,s))}};class s{constructor(t,e,s={},r={}){this.path=t,this.queryParams="string"==typeof e?new URLSearchParams(e):e,this.attributes=s,this.meta=r}setAttributes(t){return this.attributes=t,this}setAttribute(t,e){return this.attributes[t]=e,this}getAttribute(t,e=null){return this.attributes[t]||e}matchesHtmlElement(){var t=this.path.replace(/^\//,"#"),e=!1;try{e=document.querySelector(t)}catch{e=!1}return!!e}static createFromAnchor(t){var e=t.getAttribute("href"),r=t.getAttribute("title")||null,a=s.createFromUrl(e);return a?(a.meta.title=r,a):null}static createFromForm(t){var e=t.getAttribute("action"),r=t.getAttribute("title")||null,a=s.createFromUrl(e);if(!a)return null;a.meta.title=r;var n=new FormData(t),i=new URLSearchParams(n);return s.mergeUrlSearchParams(a.queryParams,i),a}static mergeUrlSearchParams(t,e){for(let[s,r]of e.entries())s.indexOf("[]")>=0&&t.has(s)?t.append(s,r):t.set(s,r)}static createFromUrl(t){var e=new URL(t,"https://"+window.location.host);return e.hash?s.createFromHash(e.hash,e.host):null}static createFromHash(t,e=window.location.host){var r=t.replace(/^#\/?/,"/"),a=new URL(r,"https://"+window.location.host);return e!=window.location.host?null:new s(a.pathname,a.searchParams)}}const r=s;class a extends HTMLElement{constructor(){super(),this.tabId=null,this.history=[],this.historyIndex=-1,this.routeCollection=null,this.ctrlKey=!1,this.rendered=!1}setRouteCollection(t){return this.routeCollection=t,this}setTabId(t){this.tabId=t,this.rendered&&this.setAttribute("id",t)}getTitle(){return this.children.length&&this.children[0].getTitle?this.children[0].getTitle():this.history.length&&this.history[this.historyIndex].meta.title?this.history[this.historyIndex].meta.title:"New tab"}focus(){return this.classList.add("tabbed-router__tab-panel--focused"),this}unfocus(){return this.classList.remove("tabbed-router__tab-panel--focused"),this}canGoBackwards(){return this.historyIndex>0}canGoForwards(){return this.historyIndex<this.history.length-1}backwards(){this.canGoBackwards()&&(this.historyIndex--,this.request(this.history[this.historyIndex]))}forwards(){this.canGoForwards()&&(this.historyIndex++,this.request(this.history[this.historyIndex]))}goTo(t){this.history=this.history.slice(0,this.historyIndex+1),this.history.push(t),this.request(t),this.historyIndex++}access(t){var e=r.createFromHash(t);this.goTo(e)}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-panel"),this.setAttribute("id",this.tabId),this.addEventListener("click",this.onAnchorClicked.bind(this)),this.addEventListener("submit",this.onFormSubmitted.bind(this)),this.addEventListener("keydown",this.onKeyDown.bind(this)),this.addEventListener("keyup",this.onKeyUp.bind(this)),this.observer=new MutationObserver(this.observer.bind(this)),this.observer.observe(this,{childList:!0,attributes:!1,subtree:!0}),this.updatedEvent()}observer(){this.updatedEvent()}updatedEvent(t=null){var e=new CustomEvent("tabbed-router:tab-updated",{bubbles:!0,detail:{tab:this,request:t}});this.dispatchEvent(e)}onKeyDown(t){this.ctrlKey=t.ctrlKey}onKeyUp(t){this.ctrlKey=t.ctrlKey}onAnchorClicked(t){var e=a.getAnchor(t.target);if(e&&!t.ctrlKey&&"_blank"!=e.getAttribute("target")){t.tabbedRouterAvaliated=!0;var s=r.createFromAnchor(e);0==s||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.goTo(s))}}onFormSubmitted(t){var e=t.target;if(!this.ctrlKey&&"_blank"!=e.getAttribute("target")){t.tabbedRouterAvaliated=!0;var s=r.createFromForm(e);0==s||"get"!=e.method||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.goTo(s))}}request(t){var e=this.routeCollection.getMatchingRoute(t),s=e?e.callIt(t):this.nothingFoundCallback(t);s?(this.stageElement(s),this.updatedEvent(t)):console.error("Route failed in returning an element.")}stageElement(t){this.clearStage(),this.addToStage(t)}clearStage(){this.querySelectorAll(":scope > *").forEach((t=>{t.remove()}))}addToStage(t){this.append(t)}nothingFoundCallback(t){var e=document.createElement("div");return e.innerHTML="Nothing found",t.meta.title=t.meta.title?t.meta.title+" ( not found )":"not found",e.getTitle=function(){return"nothing found"},e}static getAnchor(t){if(t instanceof HTMLAnchorElement)return t;do{t=t.parentNode}while(t.parentNode&&!(t instanceof HTMLAnchorElement));return t&&t instanceof HTMLAnchorElement?t:null}}const n=a;class i extends HTMLElement{constructor(){super(),this.$refs={},this.rendered=!1}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-manager__controls"),this.$refs.backwardButton=document.createElement("button"),this.$refs.backwardButton.title="Click to go back",this.$refs.backwardButton.classList.add("tabbed-router__tab-manager__backwards-button"),this.append(this.$refs.backwardButton),this.$refs.forwardButton=document.createElement("button"),this.$refs.forwardButton.title="Click to go forward",this.$refs.forwardButton.classList.add("tabbed-router__tab-manager__forwards-button"),this.append(this.$refs.forwardButton),this.$refs.backwardButton.addEventListener("click",(()=>{var t=new CustomEvent("tabbed-router:request-backwards",{bubbles:!0});this.dispatchEvent(t)})),this.$refs.forwardButton.addEventListener("click",(()=>{var t=new CustomEvent("tabbed-router:request-forwards",{bubbles:!0});this.dispatchEvent(t)})),this.parentNode.parentNode.addEventListener("tabbed-router:tab-focused",this.onTabFocused.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-updated",this.onTabUpdated.bind(this))}onTabUpdated(t){this.onTabFocused(t)}onTabFocused(t){var e=t.detail.tab;e.canGoForwards()?this.$refs.forwardButton.removeAttribute("disabled"):this.$refs.forwardButton.setAttribute("disabled","disabled"),e.canGoBackwards()?this.$refs.backwardButton.removeAttribute("disabled"):this.$refs.backwardButton.setAttribute("disabled","disabled")}}const o=i;class d extends HTMLElement{constructor(){super(),this.$refs={},this.label="",this.tabId="",this.rendered=!1}setLabel(t){return this.label=t,this.rendered&&(this.$refs.label.innerHTML=t),this}focus(){return this.classList.add("tabbed-router__tab-button--focused"),this}unfocus(){return this.classList.remove("tabbed-router__tab-button--focused"),this}setTabId(t){return this.tabId=t,this}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-button"),this.$refs.label=document.createElement("span"),this.$refs.label.innerHTML=this.label,this.append(this.$refs.label),this.$refs.closeBtn=document.createElement("button"),this.$refs.closeBtn.setAttribute("title","close tab"),this.append(this.$refs.closeBtn),this.addEventListener("click",this.onClick.bind(this)),this.$refs.closeBtn.addEventListener("click",this.onCloseBtnClicked.bind(this))}onClick(){var t={bubbles:!0,detail:this.tabId},e=new CustomEvent("tabbed-router:request-focus",t);this.dispatchEvent(e)}onCloseBtnClicked(t){t.stopPropagation(),t.preventDefault();var e={bubbles:!0,detail:this.tabId},s=new CustomEvent("tabbed-router:request-closing",e);this.dispatchEvent(s)}}const h=d;class u extends HTMLElement{constructor(){super(),this.buttonCount=0,this.$refs={buttons:{}},this.rendered=!1}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-manager__tabs-bar"),this.parentNode.parentNode.addEventListener("tabbed-router:tab-updated",this.onTabUpdated.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-focused",this.onTabFocused.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-closed",this.onTabClosed.bind(this))}createButton(t,e="new tab"){var s=new h;return s.setTabId(t),s.setLabel(e),this.append(s),this.$refs.buttons[t]=s,this.buttonCount++,s}getButton(t){return this.$refs.buttons[t]||null}getButtons(){return Object.values(this.$refs.buttons)}focusButton(t){var e=this.getButton(t);if(!e)throw`Tab ${t} not found`;for(var s of this.getButtons())s.tabId==t?s.focus():s.unfocus();return e}onTabFocused(t){var e=t.detail.tab.tabId;this.focusButton(e)}onTabClosed(t){var e=t.detail.tab.tabId;this.$refs.buttons[e].remove(),delete this.$refs.buttons[e],this.buttonCount--}onTabUpdated(t){var e,s,r;s=(e=t.detail.tab).tabId,(r=this.getButton(s))?r.setLabel(e.getTitle()):r=this.createButton(s,e.getTitle()),1==this.buttonCount&&this.focusButton(s)}}const b=u;class l extends HTMLElement{constructor(){super(),this.$refs={tabs:{}},this.tabCount=0,this.rendered=!1,this.focusedTabId=null,this.routeCollection=null,this.ctrlKey=!1}setRouteCollection(t){return this.routeCollection=t,this}generateNewTabId(){var t;do{t="tab-"+Math.floor(1e3*Math.random())}while(this.$refs.tabs[t]);return t}backwards(){var t;(t=this.getFocusedTab())&&t.backwards()}forwards(){var t;(t=this.getFocusedTab())&&t.forwards()}focusTab(t){var e=this.getTab(t);if(!e)throw`Tab ${t} not found`;for(var s of(this.focusedTabId=t,this.getTabs()))s.tabId==t?s.focus():s.unfocus();return this.fireEvent("tabbed-router:tab-focused",!0,{tab:e}),e}createTab(t,e=!0){var s=new n;return this.setTab(t,s),e&&this.focusTab(t),s}getTabs(){return Object.values(this.$refs.tabs)}getTab(t){return this.$refs.tabs[t]||null}getFocusedTab(){return this.$refs.tabs[this.focusedTabId]||null}setTab(t,e){if(this.$refs.tabs[t])throw"Tab {tabId} is already set";e.setRouteCollection(this.routeCollection),e.setTabId(t),this.$refs.tabs[t]=e,this.rendered&&this.attachTab(t)}removeTab(t){var e;return this.$refs.tabs[t]?(e=this.$refs.tabs[t],this.rendered&&this.detachTab(t),this.fireEvent("tabbed-router:tab-closed",!0,{tab:e}),e):null}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){for(var t in this.classList.add("tabbed-router__tab-manager"),this.subRenderHeader(),this.subRenderPanes(),this.$refs.tabs)this.attachTab(t);document.addEventListener("click",this.onAnchorClicked.bind(this)),document.addEventListener("submit",this.onFormSubmitted.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.addEventListener("tabbed-router:request-closing",this.onRequestToCloseTab.bind(this)),this.addEventListener("tabbed-router:request-focus",this.onRequestFocus.bind(this)),this.addEventListener("tabbed-router:request-backwards",this.onRequestBackwards.bind(this)),this.addEventListener("tabbed-router:request-forwards",this.onRequestForwards.bind(this))}subRenderHeader(){this.$refs.header=document.createElement("div"),this.$refs.header.classList.add("tabbed-router__tab-manager__header"),this.append(this.$refs.header),this.$refs.controls=new o,this.$refs.header.append(this.$refs.controls),this.$refs.tabLinks=new b,this.$refs.header.append(this.$refs.tabLinks)}subRenderPanes(){this.$refs.tabPanels=document.createElement("div"),this.$refs.tabPanels.classList.add("tabbed-router__tab-manager__tab-panels"),this.append(this.$refs.tabPanels)}onRequestFocus(t){var e=t.detail;this.focusTab(e)}onRequestBackwards(t){this.backwards()}onRequestForwards(t){this.forwards()}onRequestToCloseTab(t){if(!(this.tabCount<=1)){var e=t.detail;if(e==this.focusedTabId){var s=(this.$refs.tabLinks.getButton(e).previousSibling||this.$refs.tabLinks.getButton(e).nextSibling).tabId;this.focusTab(s)}this.removeTab(e)}}onKeyDown(t){this.ctrlKey=t.ctrlKey}onKeyUp(t){this.ctrlKey=t.ctrlKey}onAnchorClicked(t){if(!t.tabbedRouterAvaliated){var e=n.getAnchor(t.target);if(e){var s=r.createFromAnchor(e);0==s||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),t.ctrlKey?this.openInNewTab(s,!1):"_blank"==(e.getAttribute("target")||"self")?this.openInNewTab(s,!0):this.$refs.tabs[this.focusedTabId].goTo(s))}}}onFormSubmitted(t){if(!t.tabbedRouterAvaliated){var e=t.target;t.tabbedRouterAvaliated=!0;var s=r.createFromForm(e);0==s||"get"!=e.method||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.ctrlKey?this.openInNewTab(s,!1):"_blank"==(e.getAttribute("target")||"self")?this.openInNewTab(s,!0):this.$refs.tabs[this.focusedTabId].goTo(s))}}openInNewTab(t,e=!1){var s=this.generateNewTabId(),r=this.createTab(s,e);return r.goTo(t),r}attachTab(t){var e=this.$refs.tabs[t];return this.$refs.tabPanels.append(e),this.tabCount++,e}detachTab(t){var e=this.$refs.tabs[t];return e.remove(),delete this.$refs.tabs[t],this.tabCount--,e}fireEvent(t,e=!0,s={}){var r=new CustomEvent(t,{bubbles:e,detail:s});this.dispatchEvent(r)}}const c=l;customElements.define("tab-manager",c),customElements.define("tab-panel",n),customElements.define("tab-button",h),customElements.define("tab-bar",b),customElements.define("tab-controls",o);class m extends HTMLElement{getTitle(){return"First example: introduction"}connectedCallback(){this.innerHTML='<h1>Welcome</h1>\n      <p>\n          This library allow us to separate content into tabs.\n      </p>\n      <h2>Features</h2>\n      <p>\n          <strong>Navigation:</strong> We can navigate to different contents, go backwards and forwards in the navigation history.<br/>\n          Click <a href="#second-example">here</a> to go to the next page.\n      </p>'}}customElements.define("first-example",m);class f extends HTMLElement{getTitle(){var t=parseInt(this.request.getAttribute("number",1)),e="Second example: introduction";return t>1&&(e+=` ( ${t} )`),e}connectedCallback(){var t=parseInt(this.request.getAttribute("number",1)),e=`<h1>Links</h1>\n        <p>\n            You have just been introduced to the main feature of this library: the ability of navigating between diferent contents.\n        </p>\n        <p>\n            The library includes a routing system, which we can use to pass parameters.<br/>\n            Click <a href="#second-example:${t+1}">here</a> to see this number incrementing: ${t}.\n        </p>\n        <h2>New tab</h2>\n        <p>\n            Add a <code>target="_blank"</code> to <a href="#second-example:${t+1}" target="_blank">the link</a> or CTRL + click to open it in a new tab.\n        </p>`;t>1&&(e+="<h2>Navigation history</h2>\n            <p>You will also notice that you can use the buttons at the top-right corner to go backwards and forwards.</p>"),t>4&&(e+='<p>Now let\'s check the last example: <a href="#third-example">forms</a>.</p>'),this.innerHTML=e}}customElements.define("second-example",f);class p extends HTMLElement{getTitle(){return"Third example: forms"}connectedCallback(){var t='<h1>Forms</h1>\n        <p>\n            Get forms work as well ( not post ).\n        </p>\n        <form action="#third-example">\n            <label>Name:</label> <input type="text" name="name" /><br/>\n            <label>Age:</label> <input type="number" name="age" /><br/>\n            <input type="submit" value="Submit" />\n        </form>',e=this.request.queryParams.get("name")||"",s=this.request.queryParams.get("age")||"";(e||s)&&(t+="<h2>Form submitted</h2>",e&&(t+=`Your name: ${e}<br/>`),s&&(t+=`Your age: ${s}<br/>`)),this.innerHTML=t}}var v,g,w;customElements.define("third-example",p),document.addEventListener("DOMContentLoaded",(()=>{(v=new e).createRoute(/first-example/,"first-example"),v.createRoute([/second-example$/,/second-example:(?<number>.+)/],"second-example"),v.createRoute(/third-example/,"third-example"),(g=new c).setRouteCollection(v),w=g.createTab("main-tab","Main tab",!0),document.getElementById("wrapper").prepend(g),w.access("#first-example")}))})();